From 1e2044eb7a251d850ac01793a6e3d1ccd6171c9d Mon Sep 17 00:00:00 2001
From: Cody P Schafer <dev@codyps.com>
Date: Tue, 18 Nov 2014 14:52:56 -0500
Subject: [PATCH 25/28] mk: always use bin and lib as bindir and libdir for
 stage0 CFG_BUILD

---
 mk/main.mk | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/mk/main.mk b/mk/main.mk
index 0fb6f5f..676ea21 100644
--- a/mk/main.mk
+++ b/mk/main.mk
@@ -333,8 +333,18 @@ define SREQ
 
 # Destinations of artifacts for the host compiler
 HROOT$(1)_H_$(3) = $(3)/stage$(1)
+
+ifeq ($(1)-$(3),0-$$(CFG_BUILD))
+# stage0 relative paths are fixed. This is done because we don't have control
+# over where the bootstrap (snapshot or local) rustc looks to locate it's
+# libdir. At the moment, this assumes the relative paths (from sysroot aka
+# prefix) are 'lib' and 'bin'.
+HBIN$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/bin
+HLIB$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/lib
+else
 HBIN$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/$$(CFG_BINDIR_RELATIVE)
 HLIB$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/$$(CFG_LIBDIR_RELATIVE)
+endif
 
 # Destinations of artifacts for target architectures
 TROOT$(1)_T_$(2)_H_$(3) = $$(HLIB$(1)_H_$(3))/rustlib/$(2)
-- 
2.0.4

